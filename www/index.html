<!DOCTYPE html>
<html>
    <head>
        <title>Gearculator - gear ratio calculator</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <link rel="stylesheet" href="css/jquery.mobile-1.2.0.min.css" />
		<script src="js/jquery-1.8.2.min.js"></script>
		<script src="js/jquery.mobile-1.2.0.min.js"></script>
		<script type="text/javascript" src="cordova-2.0.0.js"></script>
		<script type="text/javascript">
        
			var DrawUtil = function() {};

			DrawUtil.prototype.drawWheel = function (canvasEl, size, pxPerMM) {
				var context = canvasEl.getContext("2d");
				var centerX = canvasEl.width / 2;
				var centerY = canvasEl.height / 2;
				var radius = size * pxPerMM / 2;

				context.clearRect(0, 0, canvasEl.width, canvasEl.height);
				context.beginPath();
				context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
				context.fillStyle = "#8ED6FF";
				context.fill();
				context.lineWidth = 1;
			};
			
			DrawUtil.prototype.drawChainRing = function (canvasEl, numT, pxPerMM, clearCanvas) {
				var context = canvasEl.getContext("2d");
				var centerX = canvasEl.width / 2;
				var centerY = canvasEl.height / 2;
				var radiusMM = 12.5 / ( 2 * Math.sin( Math.PI / numT ) );
				var radiusPx = radiusMM * pxPerMM;
				console.log("numT: " + numT + "radiusMM: " + radiusMM + " radiusPx: " +radiusPx);
				
				//if (!clearCanvas) context.clearRect(0, 0, canvasEl.width, canvasEl.height);
				context.beginPath();
				context.arc(centerX, centerY, radiusPx, 0, 2 * Math.PI, false);
				context.fillStyle = "#0000FF";
				context.fill();
				context.lineWidth = 1;
			};
			
			function updateStats(inputs) {
				$("#ratio").html((inputs.fCog / inputs.bCog).toFixed(2));
			}
			
			var drawUtil = new DrawUtil();
			
			var inputs = {};
			
			function render() {
				inputs.wheelSize = $('#wheel-size').val();
				inputs.fCog  = $('#f-cog').val();
				inputs.bCog  = $('#b-cog').val();
				inputs.cadence  = $('#cadence').val();
				
				var $cContainer = $("#canvas-container");
				var drawW = $cContainer.width();
			
				var windowW = $(window).width();
				var maxWheelWidthMM = 914.4; // 36 inches
				var maxWheelWidthPx = Math.floor(drawW / 2);
				var pxPerMM = maxWheelWidthPx / maxWheelWidthMM;
				var pedalW = Math.floor(drawW * .20);
				var paddingLeft = Math.floor(drawW * .06)
				
				
				var bWCanvas = document.getElementById("back-wheel");
				var pCanvas = document.getElementById("pedals");
				
				$cContainer.height(maxWheelWidthPx);
				

				bWCanvas.width = maxWheelWidthPx;
				bWCanvas.height = maxWheelWidthPx;
				bWCanvas.style.left =  $cContainer.offset().left + maxWheelWidthPx / 3 + 'px';
				bWCanvas.style.top =  $cContainer.offset().top + 'px';
				
				pCanvas.width = maxWheelWidthPx;
				pCanvas.height = maxWheelWidthPx;
				pCanvas.style.left =  $cContainer.offset().left + maxWheelWidthPx + 'px';
				pCanvas.style.top =  $cContainer.offset().top +  ( maxWheelWidthPx * 0.05) + 'px';
							
				drawUtil.drawWheel(bWCanvas, inputs.wheelSize, pxPerMM);
				drawUtil.drawChainRing(pCanvas, inputs.fCog, pxPerMM);
				drawUtil.drawChainRing(bWCanvas,inputs.bCog, pxPerMM, false);
				
				updateStats(inputs);
			}
			
			//JQ on ready
			$(function () {
				if (window.cordova) {
					document.addEventListener("deviceready", render, false);
				} else {
					render();
				}
			});
			
			$(document).live('pageinit', function(event, ui) {
				$('#f-cog').live('change', function(event, ui){
					render();
				});
				$('#b-cog').live('change', function(event, ui){
					render();
				});
				$('#candence').live('change', function(event, ui){
					render();
				});
				$('#wheel-size').live('change', function(event, ui){
					render();
				});
			});
			
		</script>
	</head>
    <body>
		<div id="index" data-role="page">
			<div data-role="header">
				<h1>Gearculator</h1>
				<a href="#about" data-role="botton">About</a>
			</div>
			<div data-role="content">	
				<div id="canvas-container" style="border: solid 1px #FF0000;" >
					<strong>Ratio:</strong> <div id="ratio" style="display: inline;"></div><br />
					<strong>Speed:</strong><br />
					<strong>Speed:</strong><br />
					<strong>Speed:</strong><br />
					<strong>Speed:</strong><br />
					<strong>Speed:</strong><br />
					
					<canvas width="100" height="100" id="back-wheel" style="position: absolute;" ></canvas>
					<canvas width="100" height="100" id="pedals" style="position: absolute;"></canvas>
				</div>
				<div style="clear: both;"></div>
				<div data-role="fieldcontain">
				<label for="b-cog">Back Cog (Teeth)</label>
				<input type="range" name="b-cog" id="b-cog" value="16" min="8" max="62" />
				</div>
				<div data-role="fieldcontain">
				<label for="f-cog">Front Cog (Teeth)</label>
				<input type="range" name="f-cog" id="f-cog" value="46" min="8" max="62" />
				</div>
				<div data-role="fieldcontain">
				<label for="wheel-size"">Wheel Size (Millimeter)</label>
				<input type="range" name="wheel-size" id="wheel-size" value="679" min="406" max="914" />
				</div>
				<div data-role="fieldcontain">
				<label for="cadence">Cadence</label>
				<input type="range" name="cadence" id="cadence" value="90" min="10" max="140" />
				</div>
				
				
			</div>
		</div>
		<div id="about" data-role="page">
			<div data-role="header">
				<h1>About Gearculator</h1>
				<a href="#index" data-role="botton">Back</a>
			</div>
			<div data-role="content">	
				<p>blah blah blah, donate:, blah blah blah Sheldon Brown rocks blah blah b</p>		
			</div>
		</div>
    </body>
</html>
